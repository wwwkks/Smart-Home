(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index","components/GlobalPopup"],{"1b55":function(e,t,o){},"1e25":function(e,t,o){"use strict";o.d(t,"b",(function(){return s})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return n}));var n={uPopup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(o.bind(null,"5db0"))}},s=function(){var e=this.$createElement;this._self._c},a=[]},"391c":function(e,t,o){},"3aee":function(e,t,o){"use strict";var n=o("e986"),s=o.n(n);s.a},"426a":function(e,t,o){"use strict";(function(e){var n=o("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=n(o("7eb4")),a=n(o("ee10")),r=(n(o("91e3")),o("8284")),i=(o("d67b"),o("bd62")),c=o("d986"),u=o("8284"),h=o("5e38"),l=h.createCommonToken,d={data:function(){return{token:"",temp:"0",humi:"0",lsens:"0",ppm:"0",led:!1,beep:!1,bright:"",weather_temp:0,weather:{temp:"4",humi:"40",windspeed:"34",text:"多云"},air:{category:"优",aqi:"24"},warning:"",suggest:null,temp_th:100,humi_th:100,lsens_th:100,ppm_th:100,text1:"警告：温度超出阈值!!!",text2:"警告：湿度超出阈值!!!",text3:"警告：光照强度超出阈值!!!",text4:"警告：烟雾报警!!!",condition1:!1,condition2:!1,condition3:!1,condition4:!1,userInput:"",chatResponse:"",messages:[],recording:!1,recorderManager:null}},computed:{computedText:function(){var e="";return this.temp>this.temp_th&&(e+=this.text1),this.humi>this.humi_th&&(e+=this.text2),this.lsens>this.lsens_th&&(e+=this.text3),this.ppm>this.ppm_th&&(e+=this.text4),this.temp<=this.temp_th&&this.humi<=this.humi_th&&this.lsens<=this.lsens_th&&this.ppm<=this.ppm_th&&(e="温度,湿度,光照,烟雾传感器检测正常"),e}},onLoad:function(){var t=l({author_key:"rQ9SmPK1mdPtwhRto/+8RNqy57QHHxqjd0GjEzLSkkiE4m2tBg3M43LRK+kvs7sW",version:"2022-05-01",user_id:"412104"});this.token=t,e.setStorageSync("token",t),this.fetchDevData(),this.getWeather(),this.showPopup()},onShow:function(){var e=this;this.fetchDevData(),setInterval((function(){e.fetchDevData()}),6e3),setInterval((function(){e.showPopup()}),5e3)},onNavigationBarButtonTap:function(t){e.reLaunch({url:"/pages/login/login"})},methods:{toggleCondition:function(e){this[e]=!this[e]},fetchThreshold:function(){var t=this;console.log("阈值check"),console.log(u.getAll()),console.log(r.ip),e.request({url:"http://".concat(r.ip,"/get_thresholds"),method:"GET",data:{username:u.getUser("username")},success:function(e){200===e.statusCode?(u.setUser("temp_th",e.data.temp_th),u.setUser("humi_th",e.data.humi_th),u.setUser("lsens_th",e.data.lsens_th),u.setUser("ppm_th",e.data.ppm_th),t.temp_th=u.getUser("temp_th"),t.humi_th=u.getUser("humi_th"),t.lsens_th=u.getUser("lsens_th"),t.ppm_th=u.getUser("ppm_th")):console.error("Failed to get thresholds:",e.data.error)},fail:function(e){console.error("Request failed:",e)}})},showPopup:function(){this.fetchThreshold(),this.temp>this.temp_th&&(console.log("弹窗temp:"+this.temp+"---------------"+this.temp_th),this.$refs.popup.showPopup()),this.humi>this.humi_th&&(console.log("弹窗humi:"+this.humi+"---------------"+this.humi_th),this.$refs.popup.showPopup2()),this.lsens>this.lsens_th&&(console.log("弹窗lsens:"+this.lsens+"---------------"+this.lsens_th),this.$refs.popup.showPopup3()),this.ppm>this.ppm_th&&(console.log("弹窗ppm:"+this.ppm+"---------------"+this.ppm_th),this.$refs.popup.showPopup4())},fetchDevData:function(){var t=this;e.request({url:"https://iot-api.heclouds.com/thingmodel/query-device-property",method:"GET",data:{product_id:"6j085UsKhq",device_name:"d1"},header:{authorization:this.token},success:function(e){console.log("获取设备数据"),console.log(e.data),t.beep="true"===e.data.data[0].value,t.humi=e.data.data[3].value,t.led="true"===e.data.data[4].value,t.temp=e.data.data[12].value,t.lsens=e.data.data[6].value,t.ppm=e.data.data[8].value}})},getWeather:function(){var t=this;console.log("天气API");var o=new Promise((function(o,n){e.request({url:"https://devapi.qweather.com/v7/weather/now?location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(e){console.log("天气请求成功"),console.log(e),"200"===e.data.code?(t.weather.temp=e.data.now.temp,t.$set(t.weather,"humi",e.data.now.humidity),t.weather.windspeed=e.data.now.windSpeed,t.weather.text=e.data.now.text,o()):(console.error("Error fetching weather data: ",e.data),n(e.data))},fail:function(e){console.error("Error fetching weather data: ",e),n(e)}})})),n=new Promise((function(o,n){e.request({url:"https://devapi.qweather.com/v7/air/now?location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(e){"200"===e.data.code?(t.air.category=e.data.now.category,t.air.aqi=e.data.now.aqi,o()):(console.error("Error fetching air data: ",e.data),n(e.data))},fail:function(e){console.error("Error fetching air data: ",e),n(e)}})})),s=new Promise((function(o,n){e.request({url:"https://devapi.qweather.com/v7/warning/now?location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(e){"200"===e.data.code?(t.warning=e.data.warning[0]||"无",o()):(console.error("Error fetching warning data: ",e.data),n(e.data))},fail:function(e){console.error("Error fetching warning data: ",e),n(e)}})})),a=new Promise((function(o,n){e.request({url:"https://devapi.qweather.com/v7/indices/1d?type=8&location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(e){"200"===e.data.code?(t.suggest=e.data.daily[0].text,o()):(console.error("Error fetching suggest data: ",e.data),n(e.data))},fail:function(e){console.error("Error fetching suggest data: ",e),n(e)}})}));Promise.all([o,n,s,a]).then((function(){console.log(t.weather.temp),console.log(t.air.aqi),console.log(t.suggest)})).catch((function(e){console.error("One or more requests failed: ",e)}))},sendMessage:function(){var t=this;return(0,a.default)(s.default.mark((function o(){var n,a,r,u,h,l,d,p,m,f,g;return s.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(t.userInput.trim()){o.next=2;break}return o.abrupt("return");case 2:return t.messages.push({type:"user",content:t.userInput}),n=t.userInput,t.userInput="",o.prev=5,o.next=8,e.request({url:"https://open.api.gu28.top/v1/chat/completions",method:"POST",data:{model:"gpt-4o-mini",messages:[{role:"system",content:"你是一个智能家居助手，负责查询传感器数据和当地天气情况、控制设备（包括led灯、蜂鸣报警器、温度阈值调整、湿度阈值调整、光强度阈值调整、烟雾浓度阈值调整、风扇挡位调整、彩灯模式调整。"},{role:"user",content:n}],functions:[{name:"controlLED",description:"控制LED灯的开关",parameters:{type:"object",properties:{status:{type:"boolean",description:"true表示开灯，false表示关灯"}},required:["status"]}},{name:"controlBeep",description:"控制报警器的开关",parameters:{type:"object",properties:{status:{type:"boolean",description:"true表示开启报警器，false表示关闭报警器"}},required:["status"]}},{name:"getSensorData",description:"获取传感器数据",parameters:{type:"object",properties:{sensor:{type:"string",enum:["temperature","humidity","light","smoke","all","weather"],description:"要查询的传感器类型"}},required:["sensor"]}},{name:"setThreshold",description:"设置各种传感器的阈值",parameters:{type:"object",properties:{type:{type:"string",enum:["temp","humi","lsens","ppm"],description:"阈值类型：temp(温度)、humi(湿度)、lsens(光照)、ppm(烟雾)"},value:{type:"number",description:"阈值数值，范围0-100"}},required:["type","value"]}},{name:"setBrightness",description:"设置LED灯亮度",parameters:{type:"object",properties:{level:{type:"integer",enum:[0,1,2,3],description:"亮度等级：0(暗)、1(较暗)、2(较亮)、3(亮)"}},required:["level"]}},{name:"setBeepVolume",description:"设置报警器音量",parameters:{type:"object",properties:{level:{type:"integer",enum:[0,1,2,3],description:"音量等级：0(小)、1(较小)、2(中)、3(大)"}},required:["level"]}},{name:"setFanSpeed",description:"设置风扇速度",parameters:{type:"object",properties:{level:{type:"integer",enum:[0,1,2,3],description:"速度等级：0(关)、1(慢)、2(中)、3(快)"}},required:["level"]}},{name:"setColorMode",description:"设置彩灯/彩虹灯模式",parameters:{type:"object",properties:{mode:{type:"integer",enum:[0,1,2,3],description:"彩灯模式：0(关)、1(模式一)、2(模式二)、3(模式三)"}},required:["mode"]}}],function_call:"auto"},header:{Authorization:"Bearer sk-jhYXW0aBnuoDWHTtu8OK5DIMCTSsWSSPuH5mvMjR57TtJSJp","Content-Type":"application/json"}});case 8:if(a=o.sent,200!==a.statusCode){o.next=60;break}if(r=a.data.choices[0].message,r.content&&t.messages.push({type:"ai",content:r.content}),!r.function_call){o.next=60;break}u=r.function_call.name,h=JSON.parse(r.function_call.arguments),l="",o.t0=u,o.next="controlLED"===o.t0?19:"controlBeep"===o.t0?22:"getSensorData"===o.t0?25:"setThreshold"===o.t0?41:"setBrightness"===o.t0?43:"setBeepVolume"===o.t0?47:"setFanSpeed"===o.t0?51:"setColorMode"===o.t0?55:59;break;case 19:return(0,i.onLedSwitch)({detail:{value:h.status}}),l="已".concat(h.status?"打开":"关闭","LED灯"),o.abrupt("break",59);case 22:return(0,i.onBeepSwitch)({detail:{value:h.status}}),l="已".concat(h.status?"打开":"关闭","报警器"),o.abrupt("break",59);case 25:o.t1=h.sensor,o.next="temperature"===o.t1?28:"humidity"===o.t1?30:"light"===o.t1?32:"smoke"===o.t1?34:"weather"===o.t1?36:"all"===o.t1?38:40;break;case 28:return l="当前温度是 ".concat(t.temp,"℃"),o.abrupt("break",40);case 30:return l="当前湿度是 ".concat(t.humi,"%"),o.abrupt("break",40);case 32:return l="当前光照强度是 ".concat(t.lsens,"lx"),o.abrupt("break",40);case 34:return l="当前烟雾浓度是 ".concat(t.ppm,"ppm"),o.abrupt("break",40);case 36:return l="威海现在天气".concat(t.weather.text,"，温度").concat(t.weather.temp,"℃，湿度").concat(t.weather.humi,"%，空气质量").concat(t.air.category),o.abrupt("break",40);case 38:return l="当前数据如下：\n温度：".concat(t.temp,"℃\n湿度：").concat(t.humi,"%\n光照：").concat(t.lsens,"lx\n烟雾：").concat(t.ppm,"ppm\nLED灯：").concat(t.led?"开启":"关闭","\n报警器：").concat(t.beep?"开启":"关闭"),o.abrupt("break",40);case 40:return o.abrupt("break",59);case 41:return h.value>=0&&h.value<=100&&((0,c.setThreshold)(h.type,h.value),d={temp:"温度",humi:"湿度",lsens:"光照",ppm:"烟雾"},l="已将".concat(d[h.type],"阈值设置为").concat(h.value),t["".concat(h.type,"_th")]=h.value),o.abrupt("break",59);case 43:return(0,i.setBrightness)(h.level),p=["暗","较暗","较亮","亮"],l="已将LED亮度设置为".concat(p[h.level]),o.abrupt("break",59);case 47:return(0,i.setBeepVolume)(h.level),m=["小","较小","中","大"],l="已将报警器音量设置为".concat(m[h.level]),o.abrupt("break",59);case 51:return(0,i.setFanSpeed)(h.level),f=["关闭","慢速","中速","快速"],l="已将风扇速度设置为".concat(f[h.level]),o.abrupt("break",59);case 55:return(0,i.setColorMode)(h.mode),g=["关闭","模式一","模式二","模式三"],l="已将彩灯设置为".concat(g[h.mode]),o.abrupt("break",59);case 59:l&&t.messages.push({type:"ai",content:l});case 60:o.next=66;break;case 62:o.prev=62,o.t2=o["catch"](5),console.error("Error:",o.t2),t.messages.push({type:"ai",content:"抱歉，我遇到了一些问题，请稍后再试。"});case 66:case"end":return o.stop()}}),o,null,[[5,62]])})))()},startRecord:function(){var t=this;this.recording=!0,this.recorderManager=e.getRecorderManager();this.recorderManager.onStart((function(){console.log("录音开始"),e.showToast({title:"开始录音",icon:"none"})})),this.recorderManager.onStop((function(o){t.recording=!1,console.log("录音结束",o),e.showToast({title:"录音结束",icon:"none"}),t.speechToText(o.tempFilePath)})),this.recorderManager.start({duration:6e4,sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50})},stopRecord:function(){this.recorderManager&&this.recorderManager.stop()},speechToText:function(t){var o=this;return(0,a.default)(s.default.mark((function n(){var a,r,i;return s.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,e.showLoading({title:"正在识别..."}),a=new FormData,a.append("file",{uri:t,type:"audio/mp3",name:"audio.mp3"}),a.append("model","whisper-1"),a.append("language","zh"),n.next=8,e.uploadFile({url:"https://open.api.gu28.top/v1/audio/transcriptions",filePath:t,name:"file",formData:{model:"whisper-1",language:"zh"},header:{Authorization:"Bearer sk-jhYXW0aBnuoDWHTtu8OK5DIMCTSsWSSPuH5mvMjR57TtJSJp",Accept:"application/json"}});case 8:if(r=n.sent,e.hideLoading(),200!==r.statusCode){n.next=20;break}if(i=JSON.parse(r.data),!i.text){n.next=17;break}o.userInput=i.text.trim(),o.sendMessage(),n.next=18;break;case 17:throw new Error("No transcription result");case 18:n.next=21;break;case 20:throw new Error("Speech recognition failed");case 21:n.next=29;break;case 23:n.prev=23,n.t0=n["catch"](0),console.error("Speech recognition error:",n.t0),e.hideLoading(),e.showToast({title:"语音识别失败，请重试",icon:"none"}),o.messages.push({type:"ai",content:"语音识别失败，请重试或使用文字输入。"});case 29:case"end":return n.stop()}}),n,null,[[0,23]])})))()}}};t.default=d}).call(this,o("df3c")["default"])},"475c":function(e,t,o){"use strict";o.d(t,"b",(function(){return s})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return n}));var n={uNoticeBar:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-notice-bar/u-notice-bar")]).then(o.bind(null,"5a7a"))}},s=function(){var e=this.$createElement,t=(this._self._c,this.messages.length);this.$mp.data=Object.assign({},{$root:{g0:t}})},a=[]},"60b7":function(e,t,o){"use strict";o.r(t);var n=o("b4b4"),s=o.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=s.a},"6eec":function(e,t,o){"use strict";(function(e,t){var n=o("47a9");o("f319");n(o("3240"));var s=n(o("dd04"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(s.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},"776e":function(e,t,o){"use strict";o.d(t,"b",(function(){return s})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return n}));var n={uSubsection:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-subsection/u-subsection")]).then(o.bind(null,"316b"))}},s=function(){var e=this.$createElement;this._self._c},a=[]},"8cf9":function(e,t,o){"use strict";o.r(t);var n=o("d893"),s=o.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=s.a},"8daa":function(e,t,o){"use strict";var n=o("391c"),s=o.n(n);s.a},"91e3":function(e,t,o){"use strict";o.r(t);var n=o("1e25"),s=o("60b7");for(var a in s)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return s[e]}))}(a);o("ba05");var r=o("828b"),i=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=i.exports},b4b4:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default={name:"GlobalPopup",data:function(){return{show:!1,show2:!1,show3:!1,show4:!1}},methods:{open:function(){},close:function(){this.show=!1},showPopup:function(){this.show=!0},open2:function(){},close2:function(){this.show2=!1},showPopup2:function(){this.show2=!0},open3:function(){},close3:function(){this.show3=!1},showPopup3:function(){this.show3=!0},open4:function(){},close4:function(){this.show4=!1},showPopup4:function(){this.show4=!0}}}},ba05:function(e,t,o){"use strict";var n=o("1b55"),s=o.n(n);s.a},bd62:function(e,t,o){"use strict";o.r(t);var n=o("776e"),s=o("d7a9");for(var a in s)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return s[e]}))}(a);o("d915");var r=o("828b"),i=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=i.exports},be0f:function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return s})),o.d(t,"a",(function(){}));var n=function(){var e=this.$createElement;this._self._c},s=[]},c2c7:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.setFanSpeed=t.setColorMode=t.setBrightness=t.setBeepVolume=t.onLedSwitch=t.onBeepSwitch=t.default=void 0;o("3240");var n=o("5e38"),s=n.createCommonToken,a={data:function(){return{token:"",led:!1,beep:!1,list1:["暗","较暗","较亮","亮"],list2:["小","较小","中","大"],list3:["关","慢","中","快"],list4:["关","模式一","模式二","模式三"],curNow1:0,curNow2:0,curNow3:0,curNow4:0}},onLoad:function(){this.token=s({author_key:"rQ9SmPK1mdPtwhRto/+8RNqy57QHHxqjd0GjEzLSkkiE4m2tBg3M43LRK+kvs7sW",version:"2022-05-01",user_id:"412104"}),this.fetchData()},onShow:function(){var e=this;setInterval((function(){e.fetchData()}),3e3),setInterval((function(){e.updateState()}),15e3)},onNavigationBarButtonTap:function(t){e.reLaunch({url:"/pages/login/login"})},methods:{sectionChange:function(e){this.curNow=e},updateState:function(){e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{bright:this.curNow1,sound:this.curNow2,speed:this.curNow3,gramode:this.curNow4}},header:{authorization:this.token},success:function(){console.log("当前状态发送成功")},fail:function(){console.log("当前状态发送失败")}})},fetchData:function(){var t=this;e.request({url:"https://iot-api.heclouds.com/thingmodel/query-device-property",method:"GET",data:{product_id:"6j085UsKhq",device_name:"d1"},header:{authorization:this.token},success:function(e){console.log("获取设备数据"),console.log(e.data),t.beep="true"===e.data.data[0].value,t.led="true"===e.data.data[5].value,console.log("led:"+t.led),console.log("beep:"+t.beep)}})},handleClick:function(e){this.curNow1=e,this.updateState()},handleBeepClick:function(e){this.curNow2=e,this.updateState()},handleSpeedClick:function(e){this.curNow3=e,this.updateState()},handleModeClick:function(e){this.curNow4=e,this.updateState()}}};t.default=a;t.onLedSwitch=function(t){console.log("AI调试:灯");var o=e.getStorageSync("token"),n=t.detail.value;e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{led:n}},header:{authorization:o},success:function(){console.log("LED "+(n?"ON":"OFF")+" !")}})};t.onBeepSwitch=function(t){console.log("AI调试:beep");var o=e.getStorageSync("token"),n=t.detail.value;e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{beep:n}},header:{authorization:o},success:function(){console.log("BEEP "+(n?"ON":"OFF")+" !")}})};t.setBrightness=function(t){console.log("AI调试:LED亮度",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{bright:t}},header:{authorization:o},success:function(){console.log("LED brightness set to level:",t)}})};t.setBeepVolume=function(t){console.log("AI调试:报警器音量",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{sound:t}},header:{authorization:o},success:function(){console.log("Beep volume set to level:",t)}})};t.setFanSpeed=function(t){console.log("AI调试:风扇速度",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{speed:t}},header:{authorization:o},success:function(){console.log("Fan speed set to level:",t)}})};t.setColorMode=function(t){console.log("AI调试:彩灯模式",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{gramode:t}},header:{authorization:o},success:function(){console.log("Color light mode set to:",t)}})}}).call(this,o("df3c")["default"])},d7a9:function(e,t,o){"use strict";o.r(t);var n=o("c2c7"),s=o.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=s.a},d893:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.setThreshold=t.default=void 0;var n=o("8284"),s=(o("d67b"),o("3240"),o("bd62")),a=o("5e38"),r=a.createCommonToken,i=o("8284"),c={data:function(){return{token:"",temp_th:100,humi_th:100,lsens_th:100,ppm_th:100}},onShow:function(){},onLoad:function(){this.token=r({author_key:"rQ9SmPK1mdPtwhRto/+8RNqy57QHHxqjd0GjEzLSkkiE4m2tBg3M43LRK+kvs7sW",version:"2022-05-01",user_id:"412104"}),this.getThresholdsFromSql()},onNavigationBarButtonTap:function(t){e.reLaunch({url:"/pages/login/login"})},methods:{getThresholdsFromSql:function(){var t=this;e.request({url:"http://".concat(n.ip,"/get_thresholds"),method:"GET",data:{username:i.getUser("username")},success:function(e){200===e.statusCode?(console.log(e),i.setUser("temp_th",e.data.temp_th),i.setUser("humi_th",e.data.humi_th),i.setUser("lsens_th",e.data.lsens_th),i.setUser("ppm_th",e.data.ppm_th),t.temp_th=i.getUser("temp_th"),t.humi_th=i.getUser("humi_th"),t.lsens_th=i.getUser("lsens_th"),t.ppm_th=i.getUser("ppm_th"),i.getAll(),t.postThresholds()):console.error("Failed to get thresholds:",e.data.error)},fail:function(e){console.error("Request failed:",e)}})},updateThresholdsFromSqlAndPost:function(){var t=this;e.request({url:"http://".concat(n.ip,"/update_thresholds"),method:"PUT",data:{username:i.getUser("username"),temp_th:this.temp_th,humi_th:this.humi_th,lsens_th:this.lsens_th,ppm_th:this.ppm_th},success:function(e){200===e.statusCode?(console.log("数据库阈值修改成功:",e.data),t.postThresholds(),(0,s.fetchData)()):(console.error("Failed to update thresholds:",e.data.error),t.rollbackThresholds())},fail:function(e){console.error("Request failed:",e),t.rollbackThresholds()}})},postThresholds:function(){e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{temp_th:this.temp_th,humi_th:this.humi_th,lsens_th:this.lsens_th,ppm_th:this.ppm_th}},header:{authorization:this.token},success:function(t){console.log("设备端阈值调整成功:",t),e.showToast({title:"阈值更新成功",icon:"success"})},fail:function(){console.log("设备端阈值调整失败")}})},sliderChange:function(e,t){switch(console.log("滑块ID:",t),console.log("新的阈值:",e.detail.value),t){case"slider1":this.temp_th=e.detail.value;break;case"slider2":this.humi_th=e.detail.value;break;case"slider3":this.lsens_th=e.detail.value;break;case"slider4":this.ppm_th=e.detail.value;break}this.updateThresholdsFromSqlAndPost()},rollbackThresholds:function(){this.temp_th=i.getUser("temp_th"),this.humi_th=i.getUser("humi_th"),this.lsens_th=i.getUser("lsens_th"),this.ppm_th=i.getUser("ppm_th"),e.showToast({title:"阈值更新失败",icon:"none"})}}};t.default=c;t.setThreshold=function(t,o){console.log("AI调试:阈值"),console.log(t),console.log(o);e.getStorageSync("token");var s=100,a=100,r=100,c=100;e.request({url:"http://".concat(n.ip,"/get_thresholds"),method:"GET",data:{username:i.getUser("username")},success:function(u){if(200===u.statusCode){switch(console.log("AI进入数据库"),i.setUser("temp_th",u.data.temp_th),i.setUser("humi_th",u.data.humi_th),i.setUser("lsens_th",u.data.lsens_th),i.setUser("ppm_th",u.data.ppm_th),s=i.getUser("temp_th"),a=i.getUser("humi_th"),r=i.getUser("lsens_th"),c=i.getUser("ppm_th"),"".concat(t)){case"temp":s=o;break;case"humi":a=o;break;case"lsens":r=o;break;case"ppm":c=o;break;default:console.log("未匹配到任何 case");break}e.request({url:"http://".concat(n.ip,"/update_thresholds"),method:"PUT",data:{username:i.getUser("username"),temp_th:s,humi_th:a,lsens_th:r,ppm_th:c},success:function(e){console.log("AI:修改阈值数据库"),200===e.statusCode?console.log("数据库阈值修改成功:",e.data):console.error("Failed to update thresholds:",e.data.error)},fail:function(e){console.error("Request failed:",e)}})}else console.error("Failed to get thresholds:",u.data.error)},fail:function(e){console.error("Request failed:",e)}})}}).call(this,o("df3c")["default"])},d915:function(e,t,o){"use strict";var n=o("fb0e"),s=o.n(n);s.a},d986:function(e,t,o){"use strict";o.r(t);var n=o("be0f"),s=o("8cf9");for(var a in s)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return s[e]}))}(a);o("8daa");var r=o("828b"),i=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=i.exports},dd04:function(e,t,o){"use strict";o.r(t);var n=o("475c"),s=o("fe48");for(var a in s)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return s[e]}))}(a);o("3aee");var r=o("828b"),i=Object(r["a"])(s["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);t["default"]=i.exports},e986:function(e,t,o){},fb0e:function(e,t,o){},fe48:function(e,t,o){"use strict";o.r(t);var n=o("426a"),s=o.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);t["default"]=s.a}},[["6eec","common/runtime","common/vendor"]]]);