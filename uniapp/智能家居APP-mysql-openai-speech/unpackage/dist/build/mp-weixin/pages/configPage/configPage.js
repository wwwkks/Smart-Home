(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/configPage/configPage"],{"391c":function(e,t,o){},5226:function(e,t,o){"use strict";(function(e,t){var s=o("47a9");o("f319");s(o("3240"));var n=s(o("d986"));e.__webpack_require_UNI_MP_PLUGIN__=o,t(n.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},"776e":function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return a})),o.d(t,"a",(function(){return s}));var s={uSubsection:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-subsection/u-subsection")]).then(o.bind(null,"316b"))}},n=function(){var e=this.$createElement;this._self._c},a=[]},"8cf9":function(e,t,o){"use strict";o.r(t);var s=o("d893"),n=o.n(s);for(var a in s)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return s[e]}))}(a);t["default"]=n.a},"8daa":function(e,t,o){"use strict";var s=o("391c"),n=o.n(s);n.a},bd62:function(e,t,o){"use strict";o.r(t);var s=o("776e"),n=o("d7a9");for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);o("d915");var r=o("828b"),i=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);t["default"]=i.exports},be0f:function(e,t,o){"use strict";o.d(t,"b",(function(){return s})),o.d(t,"c",(function(){return n})),o.d(t,"a",(function(){}));var s=function(){var e=this.$createElement;this._self._c},n=[]},c2c7:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.setFanSpeed=t.setColorMode=t.setBrightness=t.setBeepVolume=t.onLedSwitch=t.onBeepSwitch=t.default=void 0;o("3240");var s=o("5e38"),n=s.createCommonToken,a={data:function(){return{token:"",led:!1,beep:!1,list1:["暗","较暗","较亮","亮"],list2:["小","较小","中","大"],list3:["关","慢","中","快"],list4:["关","模式一","模式二","模式三"],curNow1:0,curNow2:0,curNow3:0,curNow4:0}},onLoad:function(){this.token=n({author_key:"rQ9SmPK1mdPtwhRto/+8RNqy57QHHxqjd0GjEzLSkkiE4m2tBg3M43LRK+kvs7sW",version:"2022-05-01",user_id:"412104"}),this.fetchData()},onShow:function(){var e=this;setInterval((function(){e.fetchData()}),3e3),setInterval((function(){e.updateState()}),15e3)},onNavigationBarButtonTap:function(t){e.reLaunch({url:"/pages/login/login"})},methods:{sectionChange:function(e){this.curNow=e},updateState:function(){e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{bright:this.curNow1,sound:this.curNow2,speed:this.curNow3,gramode:this.curNow4}},header:{authorization:this.token},success:function(){console.log("当前状态发送成功")},fail:function(){console.log("当前状态发送失败")}})},fetchData:function(){var t=this;e.request({url:"https://iot-api.heclouds.com/thingmodel/query-device-property",method:"GET",data:{product_id:"6j085UsKhq",device_name:"d1"},header:{authorization:this.token},success:function(e){console.log("获取设备数据"),console.log(e.data),t.beep="true"===e.data.data[0].value,t.led="true"===e.data.data[5].value,console.log("led:"+t.led),console.log("beep:"+t.beep)}})},handleClick:function(e){this.curNow1=e,this.updateState()},handleBeepClick:function(e){this.curNow2=e,this.updateState()},handleSpeedClick:function(e){this.curNow3=e,this.updateState()},handleModeClick:function(e){this.curNow4=e,this.updateState()}}};t.default=a;t.onLedSwitch=function(t){console.log("AI调试:灯");var o=e.getStorageSync("token"),s=t.detail.value;e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{led:s}},header:{authorization:o},success:function(){console.log("LED "+(s?"ON":"OFF")+" !")}})};t.onBeepSwitch=function(t){console.log("AI调试:beep");var o=e.getStorageSync("token"),s=t.detail.value;e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{beep:s}},header:{authorization:o},success:function(){console.log("BEEP "+(s?"ON":"OFF")+" !")}})};t.setBrightness=function(t){console.log("AI调试:LED亮度",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{bright:t}},header:{authorization:o},success:function(){console.log("LED brightness set to level:",t)}})};t.setBeepVolume=function(t){console.log("AI调试:报警器音量",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{sound:t}},header:{authorization:o},success:function(){console.log("Beep volume set to level:",t)}})};t.setFanSpeed=function(t){console.log("AI调试:风扇速度",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{speed:t}},header:{authorization:o},success:function(){console.log("Fan speed set to level:",t)}})};t.setColorMode=function(t){console.log("AI调试:彩灯模式",t);var o=e.getStorageSync("token");e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{gramode:t}},header:{authorization:o},success:function(){console.log("Color light mode set to:",t)}})}}).call(this,o("df3c")["default"])},d7a9:function(e,t,o){"use strict";o.r(t);var s=o("c2c7"),n=o.n(s);for(var a in s)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return s[e]}))}(a);t["default"]=n.a},d893:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.setThreshold=t.default=void 0;var s=o("8284"),n=(o("d67b"),o("3240"),o("bd62")),a=o("5e38"),r=a.createCommonToken,i=o("8284"),c={data:function(){return{token:"",temp_th:100,humi_th:100,lsens_th:100,ppm_th:100}},onShow:function(){},onLoad:function(){this.token=r({author_key:"rQ9SmPK1mdPtwhRto/+8RNqy57QHHxqjd0GjEzLSkkiE4m2tBg3M43LRK+kvs7sW",version:"2022-05-01",user_id:"412104"}),this.getThresholdsFromSql()},onNavigationBarButtonTap:function(t){e.reLaunch({url:"/pages/login/login"})},methods:{getThresholdsFromSql:function(){var t=this;e.request({url:"http://".concat(s.ip,"/get_thresholds"),method:"GET",data:{username:i.getUser("username")},success:function(e){200===e.statusCode?(console.log(e),i.setUser("temp_th",e.data.temp_th),i.setUser("humi_th",e.data.humi_th),i.setUser("lsens_th",e.data.lsens_th),i.setUser("ppm_th",e.data.ppm_th),t.temp_th=i.getUser("temp_th"),t.humi_th=i.getUser("humi_th"),t.lsens_th=i.getUser("lsens_th"),t.ppm_th=i.getUser("ppm_th"),i.getAll(),t.postThresholds()):console.error("Failed to get thresholds:",e.data.error)},fail:function(e){console.error("Request failed:",e)}})},updateThresholdsFromSqlAndPost:function(){var t=this;e.request({url:"http://".concat(s.ip,"/update_thresholds"),method:"PUT",data:{username:i.getUser("username"),temp_th:this.temp_th,humi_th:this.humi_th,lsens_th:this.lsens_th,ppm_th:this.ppm_th},success:function(e){200===e.statusCode?(console.log("数据库阈值修改成功:",e.data),t.postThresholds(),(0,n.fetchData)()):(console.error("Failed to update thresholds:",e.data.error),t.rollbackThresholds())},fail:function(e){console.error("Request failed:",e),t.rollbackThresholds()}})},postThresholds:function(){e.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{temp_th:this.temp_th,humi_th:this.humi_th,lsens_th:this.lsens_th,ppm_th:this.ppm_th}},header:{authorization:this.token},success:function(t){console.log("设备端阈值调整成功:",t),e.showToast({title:"阈值更新成功",icon:"success"})},fail:function(){console.log("设备端阈值调整失败")}})},sliderChange:function(e,t){switch(console.log("滑块ID:",t),console.log("新的阈值:",e.detail.value),t){case"slider1":this.temp_th=e.detail.value;break;case"slider2":this.humi_th=e.detail.value;break;case"slider3":this.lsens_th=e.detail.value;break;case"slider4":this.ppm_th=e.detail.value;break}this.updateThresholdsFromSqlAndPost()},rollbackThresholds:function(){this.temp_th=i.getUser("temp_th"),this.humi_th=i.getUser("humi_th"),this.lsens_th=i.getUser("lsens_th"),this.ppm_th=i.getUser("ppm_th"),e.showToast({title:"阈值更新失败",icon:"none"})}}};t.default=c;t.setThreshold=function(t,o){console.log("AI调试:阈值"),console.log(t),console.log(o);e.getStorageSync("token");var n=100,a=100,r=100,c=100;e.request({url:"http://".concat(s.ip,"/get_thresholds"),method:"GET",data:{username:i.getUser("username")},success:function(u){if(200===u.statusCode){switch(console.log("AI进入数据库"),i.setUser("temp_th",u.data.temp_th),i.setUser("humi_th",u.data.humi_th),i.setUser("lsens_th",u.data.lsens_th),i.setUser("ppm_th",u.data.ppm_th),n=i.getUser("temp_th"),a=i.getUser("humi_th"),r=i.getUser("lsens_th"),c=i.getUser("ppm_th"),"".concat(t)){case"temp":n=o;break;case"humi":a=o;break;case"lsens":r=o;break;case"ppm":c=o;break;default:console.log("未匹配到任何 case");break}e.request({url:"http://".concat(s.ip,"/update_thresholds"),method:"PUT",data:{username:i.getUser("username"),temp_th:n,humi_th:a,lsens_th:r,ppm_th:c},success:function(e){console.log("AI:修改阈值数据库"),200===e.statusCode?console.log("数据库阈值修改成功:",e.data):console.error("Failed to update thresholds:",e.data.error)},fail:function(e){console.error("Request failed:",e)}})}else console.error("Failed to get thresholds:",u.data.error)},fail:function(e){console.error("Request failed:",e)}})}}).call(this,o("df3c")["default"])},d915:function(e,t,o){"use strict";var s=o("fb0e"),n=o.n(s);n.a},d986:function(e,t,o){"use strict";o.r(t);var s=o("be0f"),n=o("8cf9");for(var a in n)["default"].indexOf(a)<0&&function(e){o.d(t,e,(function(){return n[e]}))}(a);o("8daa");var r=o("828b"),i=Object(r["a"])(n["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],void 0);t["default"]=i.exports},fb0e:function(e,t,o){}},[["5226","common/runtime","common/vendor"]]]);