(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/configPage/configPage"],{"0f79":function(t,e,s){"use strict";s.d(e,"b",(function(){return o})),s.d(e,"c",(function(){return r})),s.d(e,"a",(function(){}));var o=function(){var t=this.$createElement;this._self._c},r=[]},2627:function(t,e,s){"use strict";var o=s("e1ec"),r=s.n(o);r.a},"34c5":function(t,e,s){"use strict";s.r(e);var o=s("0f79"),r=s("427d");for(var a in r)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return r[t]}))}(a);s("2627");var h=s("828b"),n=Object(h["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);e["default"]=n.exports},"427d":function(t,e,s){"use strict";s.r(e);var o=s("4293"),r=s.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return o[t]}))}(a);e["default"]=r.a},4293:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.setThreshold=e.default=void 0;var o=s("925a"),r=(s("d67b"),s("3240"),s("4543")),a=r.createCommonToken,h=s("925a"),n=a({author_key:"rQ9SmPK1mdPtwhRto/+8RNqy57QHHxqjd0GjEzLSkkiE4m2tBg3M43LRK+kvs7sW",version:"2022-05-01",user_id:"412104"}),l={data:function(){return{temp_th:100,humi_th:100,lsens_th:100,ppm_th:100}},onShow:function(){var t=this;setInterval((function(){t.getThresholdsFromSqlAndPost()}),1e4)},onLoad:function(){this.getThresholdsFromSqlAndPost()},onNavigationBarButtonTap:function(e){t.reLaunch({url:"/pages/login/login"})},methods:{getThresholdsFromSqlAndPost:function(){var e=this;t.request({url:"http://".concat(o.ip,"/get_thresholds"),method:"GET",data:{username:h.getUser("username")},success:function(t){200===t.statusCode?(console.log(t),h.setUser("temp_th",t.data.temp_th),h.setUser("humi_th",t.data.humi_th),h.setUser("lsens_th",t.data.lsens_th),h.setUser("ppm_th",t.data.ppm_th),e.temp_th=h.getUser("temp_th"),e.humi_th=h.getUser("humi_th"),e.lsens_th=h.getUser("lsens_th"),e.ppm_th=h.getUser("ppm_th"),h.getAll(),e.postThresholds("false")):console.error("Failed to get thresholds:",t.data.error)},fail:function(t){console.error("Request failed:",t)}})},updateThresholdsFromSqlAndPost:function(e){var s=this;t.request({url:"http://".concat(o.ip,"/update_thresholds"),method:"PUT",data:{username:h.getUser("username"),temp_th:this.temp_th,humi_th:this.humi_th,lsens_th:this.lsens_th,ppm_th:this.ppm_th},success:function(t){200===t.statusCode?(console.log("数据库阈值修改成功:",t.data),s.postThresholds(e)):(console.error("Failed to update thresholds:",t.data.error),s.rollbackThresholds())},fail:function(t){console.error("Request failed:",t),s.rollbackThresholds()}})},postThresholds:function(e){t.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{temp_th:this.temp_th,humi_th:this.humi_th,lsens_th:this.lsens_th,ppm_th:this.ppm_th}},header:{authorization:n},success:function(s){console.log("设备端阈值调整成功:",s),"true"==e&&t.showToast({title:"阈值更新成功",icon:"success"})},fail:function(){console.log("设备端阈值调整失败")}})},sliderChange:function(t,e){switch(console.log("滑块ID:",e),console.log("新的阈值:",t.detail.value),e){case"slider1":this.temp_th=t.detail.value;break;case"slider2":this.humi_th=t.detail.value;break;case"slider3":this.lsens_th=t.detail.value;break;case"slider4":this.ppm_th=t.detail.value;break}this.updateThresholdsFromSqlAndPost("true")},rollbackThresholds:function(){this.temp_th=h.getUser("temp_th"),this.humi_th=h.getUser("humi_th"),this.lsens_th=h.getUser("lsens_th"),this.ppm_th=h.getUser("ppm_th"),t.showToast({title:"阈值更新失败",icon:"none"})}}};e.default=l;e.setThreshold=function(e,s){console.log("AI调试:阈值"),console.log(e),console.log(s);var r=100,a=100,l=100,i=100;t.request({url:"http://".concat(o.ip,"/get_thresholds"),method:"GET",data:{username:h.getUser("username")},success:function(u){if(200===u.statusCode){switch(console.log("AI进入数据库"),h.setUser("temp_th",u.data.temp_th),h.setUser("humi_th",u.data.humi_th),h.setUser("lsens_th",u.data.lsens_th),h.setUser("ppm_th",u.data.ppm_th),r=h.getUser("temp_th"),a=h.getUser("humi_th"),l=h.getUser("lsens_th"),i=h.getUser("ppm_th"),"".concat(e)){case"temp":r=s;break;case"humi":a=s;break;case"lsens":l=s;break;case"ppm":i=s;break;default:console.log("未匹配到任何 case");break}t.request({url:"http://".concat(o.ip,"/update_thresholds"),method:"PUT",data:{username:h.getUser("username"),temp_th:r,humi_th:a,lsens_th:l,ppm_th:i},success:function(e){console.log("AI:修改阈值数据库"),200===e.statusCode?(console.log("数据库阈值修改成功:",e.data),t.request({url:"https://iot-api.heclouds.com/thingmodel/set-device-property",method:"POST",data:{product_id:"6j085UsKhq",device_name:"d1",params:{temp_th:r,humi_th:a,lsens_th:l,ppm_th:i}},header:{authorization:n},success:function(e){console.log("AI设备端阈值调整成功:",e),t.showToast({title:"AI阈值更新成功",icon:"success"})},fail:function(){console.log("设备端阈值调整失败")}})):console.error("Failed to update thresholds:",e.data.error)},fail:function(t){console.error("Request failed:",t)}})}else console.error("Failed to get thresholds:",u.data.error)},fail:function(t){console.error("Request failed:",t)}})}}).call(this,s("df3c")["default"])},b12f:function(t,e,s){"use strict";(function(t,e){var o=s("47a9");s("f055");o(s("3240"));var r=o(s("34c5"));t.__webpack_require_UNI_MP_PLUGIN__=s,e(r.default)}).call(this,s("3223")["default"],s("df3c")["createPage"])},e1ec:function(t,e,s){}},[["b12f","common/runtime","common/vendor"]]]);