(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/index","components/GlobalPopup"],{1067:function(t,e,o){},"141a":function(t,e,o){"use strict";o.r(e);var n=o("28eb"),i=o.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},"28eb":function(t,e,o){"use strict";(function(t){var n=o("47a9");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;n(o("b7a3"));var i=o("491b"),s=(o("d67b"),o("491b")),a=o("e439"),r=a.createCommonToken,u={data:function(){return{token:"",temp:"",humi:"",lsens:"",ppm:"",led:!1,beep:!1,bright:"",weather_temp:0,weather:{temp:"4",humi:"40",windspeed:"34",text:"多云"},air:{category:"优",aqi:"24"},warning:"",suggest:null,temp_th:100,humi_th:100,lsens_th:100,ppm_th:100,text1:"警告：温度超出阈值!!!",text2:"警告：湿度超出阈值!!!",text3:"警告：光照强度超出阈值!!!",text4:"警告：烟雾报警!!!",condition1:!1,condition2:!1,condition3:!1,condition4:!1}},computed:{computedText:function(){var t="";return this.temp>this.temp_th&&(t+=this.text1),this.humi>this.humi_th&&(t+=this.text2),this.lsens>this.lsens_th&&(t+=this.text3),this.ppm>this.ppm_th&&(t+=this.text4),this.temp<=this.temp_th&&this.humi<=this.humi_th&&this.lsens<=this.lsens_th&&this.ppm<=this.ppm_th&&(t="温度,湿度,光照,烟雾传感器检测正常"),t}},onLoad:function(){this.token=r({author_key:"rQ9SmPK1mdPtwhRto/+8RNqy57QHHxqjd0GjEzLSkkiE4m2tBg3M43LRK+kvs7sW",version:"2022-05-01",user_id:"412104"}),this.fetchDevData(),this.getWeather(),this.showPopup()},onShow:function(){var t=this;setInterval((function(){t.fetchDevData()}),6e3),setInterval((function(){t.showPopup()}),5e3)},onNavigationBarButtonTap:function(e){t.reLaunch({url:"/pages/login/login"})},methods:{toggleCondition:function(t){this[t]=!this[t]},fetchThreshold:function(){var e=this;console.log("阈值check"),console.log(s.getAll()),console.log(i.ip),t.request({url:"http://".concat(i.ip,"/get_thresholds"),method:"GET",data:{username:s.getUser("username")},success:function(t){200===t.statusCode?(s.setUser("temp_th",t.data.temp_th),s.setUser("humi_th",t.data.humi_th),s.setUser("lsens_th",t.data.lsens_th),s.setUser("ppm_th",t.data.ppm_th),e.temp_th=s.getUser("temp_th"),e.humi_th=s.getUser("humi_th"),e.lsens_th=s.getUser("lsens_th"),e.ppm_th=s.getUser("ppm_th")):console.error("Failed to get thresholds:",t.data.error)},fail:function(t){console.error("Request failed:",t)}})},showPopup:function(){this.fetchThreshold(),this.temp>this.temp_th&&(console.log("弹窗temp:"+this.temp+"---------------"+this.temp_th),this.$refs.popup.showPopup()),this.humi>this.humi_th&&(console.log("弹窗humi:"+this.humi+"---------------"+this.humi_th),this.$refs.popup.showPopup2()),this.lsens>this.lsens_th&&(console.log("弹窗lsens:"+this.lsens+"---------------"+this.lsens_th),this.$refs.popup.showPopup3()),this.ppm>this.ppm_th&&(console.log("弹窗ppm:"+this.ppm+"---------------"+this.ppm_th),this.$refs.popup.showPopup4())},fetchDevData:function(){var e=this;t.request({url:"https://iot-api.heclouds.com/thingmodel/query-device-property",method:"GET",data:{product_id:"6j085UsKhq",device_name:"d1"},header:{authorization:this.token},success:function(t){console.log("获取设备数据"),console.log(t.data),e.beep="true"===t.data.data[0].value,e.humi=t.data.data[3].value,e.led="true"===t.data.data[4].value,e.temp=t.data.data[12].value,e.lsens=t.data.data[6].value,e.ppm=t.data.data[8].value}})},getWeather:function(){var e=this;console.log("天气API");var o=new Promise((function(o,n){t.request({url:"https://devapi.qweather.com/v7/weather/now?location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(t){console.log("天气请求成功"),console.log(t),"200"===t.data.code?(e.weather.temp=t.data.now.temp,e.$set(e.weather,"humi",t.data.now.humidity),e.weather.windspeed=t.data.now.windSpeed,e.weather.text=t.data.now.text,o()):(console.error("Error fetching weather data: ",t.data),n(t.data))},fail:function(t){console.error("Error fetching weather data: ",t),n(t)}})})),n=new Promise((function(o,n){t.request({url:"https://devapi.qweather.com/v7/air/now?location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(t){"200"===t.data.code?(e.air.category=t.data.now.category,e.air.aqi=t.data.now.aqi,o()):(console.error("Error fetching air data: ",t.data),n(t.data))},fail:function(t){console.error("Error fetching air data: ",t),n(t)}})})),i=new Promise((function(o,n){t.request({url:"https://devapi.qweather.com/v7/warning/now?location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(t){"200"===t.data.code?(e.warning=t.data.warning[0]||"无",o()):(console.error("Error fetching warning data: ",t.data),n(t.data))},fail:function(t){console.error("Error fetching warning data: ",t),n(t)}})})),s=new Promise((function(o,n){t.request({url:"https://devapi.qweather.com/v7/indices/1d?type=8&location=101121301&key=6ff97dc76f834ab2b0dd2e13b35c5775",method:"GET",success:function(t){"200"===t.data.code?(e.suggest=t.data.daily[0].text,o()):(console.error("Error fetching suggest data: ",t.data),n(t.data))},fail:function(t){console.error("Error fetching suggest data: ",t),n(t)}})}));Promise.all([o,n,i,s]).then((function(){console.log(e.weather.temp),console.log(e.air.aqi),console.log(e.suggest)})).catch((function(t){console.error("One or more requests failed: ",t)}))}}};e.default=u}).call(this,o("df3c")["default"])},"6c44":function(t,e,o){"use strict";o.r(e);var n=o("b279"),i=o.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},"92d6":function(t,e,o){},a41c:function(t,e,o){"use strict";var n=o("1067"),i=o.n(n);i.a},b279:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={name:"GlobalPopup",data:function(){return{show:!1,show2:!1,show3:!1,show4:!1}},methods:{open:function(){},close:function(){this.show=!1},showPopup:function(){this.show=!0},open2:function(){},close2:function(){this.show2=!1},showPopup2:function(){this.show2=!0},open3:function(){},close3:function(){this.show3=!1},showPopup3:function(){this.show3=!0},open4:function(){},close4:function(){this.show4=!1},showPopup4:function(){this.show4=!0}}}},b370:function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return n}));var n={uPopup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-popup/u-popup")]).then(o.bind(null,"517b"))}},i=function(){var t=this.$createElement;this._self._c},s=[]},b78f:function(t,e,o){"use strict";o.r(e);var n=o("f7cd"),i=o("141a");for(var s in i)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("a41c");var a=o("828b"),r=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=r.exports},b7a3:function(t,e,o){"use strict";o.r(e);var n=o("b370"),i=o("6c44");for(var s in i)["default"].indexOf(s)<0&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("f1df");var a=o("828b"),r=Object(a["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=r.exports},bfa0:function(t,e,o){"use strict";(function(t,e){var n=o("47a9");o("1f9a");n(o("3240"));var i=n(o("b78f"));t.__webpack_require_UNI_MP_PLUGIN__=o,e(i.default)}).call(this,o("3223")["default"],o("df3c")["createPage"])},f1df:function(t,e,o){"use strict";var n=o("92d6"),i=o.n(n);i.a},f7cd:function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return n}));var n={uNoticeBar:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uview-ui/components/u-notice-bar/u-notice-bar")]).then(o.bind(null,"8923"))}},i=function(){var t=this.$createElement;this._self._c},s=[]}},[["bfa0","common/runtime","common/vendor"]]]);